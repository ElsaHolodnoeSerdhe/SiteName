<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Подтверждение email</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 400px; margin: 0 auto; padding: 20px; }
        .step { display: none; }
        .active { display: block; }
        input, button { width: 100%; padding: 10px; margin: 10px 0; box-sizing: border-box; }
        button { background: #4285F4; color: white; border: none; cursor: pointer; }
        .error { color: red; }
    </style>
</head>
<body>
    <!-- Шаг 1: Ввод email -->
    <div id="step1" class="step active">
        <h2>Введите ваш email</h2>
        <input type="email" id="email" placeholder="example@gmail.com" required>
        <button onclick="sendCode()">Отправить код</button>
        <p id="emailError" class="error"></p>
    </div>

    <!-- Шаг 2: Ввод кода -->
    <div id="step2" class="step">
        <h2>Введите код подтверждения</h2>
        <input type="text" id="verificationCode" placeholder="123456">
        <button onclick="verifyCode()">Подтвердить</button>
        <p id="codeError" class="error"></p>
    </div>

    <script>
        let generatedCode = "";
        const email = document.getElementById("email");
        const emailError = document.getElementById("emailError");
        const codeError = document.getElementById("codeError");

        // Отправка кода
        function sendCode() {
            const userEmail = email.value.trim();
            
            // Проверка домена
            if (!userEmail.endsWith("@gmail.com") && !userEmail.endsWith("@indigobook.com")) {
                emailError.textContent = "Только Gmail или Indigobook!";
                return;
            }

            // Генерация 6-значного кода
            generatedCode = Math.floor(100000 + Math.random() * 900000);
            
            // Отправка через FormSubmit
            fetch("https://formsubmit.co/ajax/ВАШ_EMAIL@gmail.com", {
                method: "POST",
                headers: { 
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({
                    email: userEmail,
                    _subject: "Код подтверждения",
                    _autoresponse: `Ваш код подтверждения: ${generatedCode}`,
                    _template: "plain"
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById("step1").classList.remove("active");
                    document.getElementById("step2").classList.add("active");
                }
            })
            .catch(error => {
                emailError.textContent = "Ошибка отправки: " + error;
            });
        }

        // Проверка кода
        function verifyCode() {
            const userCode = document.getElementById("verificationCode").value;
            
            if (userCode === generatedCode.toString()) {
                alert("Email подтвержден!");
                // Здесь можно отправить данные на сервер
            } else {
                codeError.textContent = "Неверный код!";
            }
        }
    </script>
</body>
</html>
